{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\masat\\\\mlm-system\\\\src\\\\components\\\\Auth\\\\PrivateRoute.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { Navigate } from 'react-router-dom';\nimport { supabase } from '../../utils/supabaseClient';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function PrivateRoute({\n  children,\n  adminOnly = false\n}) {\n  _s();\n  const [loading, setLoading] = useState(true);\n  const [user, setUser] = useState(null);\n  const [userRole, setUserRole] = useState(null);\n  useEffect(() => {\n    checkUser();\n    const {\n      data: authListener\n    } = supabase.auth.onAuthStateChange(async (event, session) => {\n      if (session !== null && session !== void 0 && session.user) {\n        const {\n          data: profile\n        } = await supabase.from('profiles').select('role').eq('id', session.user.id).single();\n        setUser(session.user);\n        setUserRole(profile === null || profile === void 0 ? void 0 : profile.role);\n      } else {\n        setUser(null);\n        setUserRole(null);\n      }\n      setLoading(false);\n    });\n    return () => {\n      authListener.subscription.unsubscribe();\n    };\n  }, []);\n  async function checkUser() {\n    try {\n      const {\n        data: {\n          user\n        }\n      } = await supabase.auth.getUser();\n      if (user) {\n        const {\n          data: profile\n        } = await supabase.from('profiles').select('role').eq('id', user.id).single();\n        setUser(user);\n        setUserRole(profile === null || profile === void 0 ? void 0 : profile.role);\n      }\n    } catch (error) {\n      console.error('Error checking user:', error);\n    } finally {\n      setLoading(false);\n    }\n  }\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 16\n    }, this);\n  }\n  if (!user) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 16\n    }, this);\n  }\n  if (adminOnly && userRole !== 'admin') {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/dashboard\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 16\n    }, this);\n  }\n  return children;\n}\n_s(PrivateRoute, \"bVb3li9ShQIEQAkNkSNK33DgGP0=\");\n_c = PrivateRoute;\nvar _c;\n$RefreshReg$(_c, \"PrivateRoute\");","map":{"version":3,"names":["React","useEffect","useState","Navigate","supabase","jsxDEV","_jsxDEV","PrivateRoute","children","adminOnly","_s","loading","setLoading","user","setUser","userRole","setUserRole","checkUser","data","authListener","auth","onAuthStateChange","event","session","profile","from","select","eq","id","single","role","subscription","unsubscribe","getUser","error","console","fileName","_jsxFileName","lineNumber","columnNumber","to","_c","$RefreshReg$"],"sources":["C:/Users/masat/mlm-system/src/components/Auth/PrivateRoute.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { Navigate } from 'react-router-dom';\r\nimport { supabase } from '../../utils/supabaseClient';\r\n\r\nexport default function PrivateRoute({ children, adminOnly = false }) {\r\n    const [loading, setLoading] = useState(true);\r\n    const [user, setUser] = useState(null);\r\n    const [userRole, setUserRole] = useState(null);\r\n\r\n    useEffect(() => {\r\n        checkUser();\r\n        const { data: authListener } = supabase.auth.onAuthStateChange(async (event, session) => {\r\n            if (session?.user) {\r\n                const { data: profile } = await supabase\r\n                    .from('profiles')\r\n                    .select('role')\r\n                    .eq('id', session.user.id)\r\n                    .single();\r\n                setUser(session.user);\r\n                setUserRole(profile?.role);\r\n            } else {\r\n                setUser(null);\r\n                setUserRole(null);\r\n            }\r\n            setLoading(false);\r\n        });\r\n\r\n        return () => {\r\n            authListener.subscription.unsubscribe();\r\n        };\r\n    }, []);\r\n\r\n    async function checkUser() {\r\n        try {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (user) {\r\n                const { data: profile } = await supabase\r\n                    .from('profiles')\r\n                    .select('role')\r\n                    .eq('id', user.id)\r\n                    .single();\r\n                setUser(user);\r\n                setUserRole(profile?.role);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error checking user:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    if (loading) {\r\n        return <div>Loading...</div>;\r\n    }\r\n\r\n    if (!user) {\r\n        return <Navigate to=\"/\" />;\r\n    }\r\n\r\n    if (adminOnly && userRole !== 'admin') {\r\n        return <Navigate to=\"/dashboard\" />;\r\n    }\r\n\r\n    return children;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}